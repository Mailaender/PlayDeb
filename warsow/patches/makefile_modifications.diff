Some makefile modifications, making it more useful in building
Debian packages.
===================================================================
Index: source/Makefile
===================================================================
--- a/source/Makefile	2012-08-07 16:29:18.000000000 +0200
+++ b/source/Makefile	2012-10-10 21:16:42.017507350 +0200
@@ -50,7 +50,7 @@
 else
 CC?=gcc
 CXX?=g++
-LD=gcc
+LD?=gcc
 LXX?=g++
 AR=ar
 RANLIB=ranlib
@@ -68,7 +68,7 @@
 SHARED_LIBRARY_EXTENSION=so
 endif
 
-BUILDDIR=build$(ARCH)
+BUILDDIR=build
 
 ifeq ($(DEBUG_BUILD), YES)
 BINDIR=debug
@@ -133,7 +133,7 @@
 ifeq ($(USE_MINGW),YES)
 CFLAGS_COMMON=-D_M_IX86 $(CFLAGS) -MD -I. -Iwin32/include -I../libsrcs/zlib -I../libsrcs/libcurl/include -D__WIN32 -D__USE_LARGEFILE -D__USE_LARGEFILE64 -mwindows -Wall -Wno-unknown-pragmas -Wno-unused-function
 CFLAGS_RELEASE=-O2 -fno-strict-aliasing -ffast-math -funroll-loops -DNDEBUG
-CFLAGS_DEBUG=-O0 -ggdb -D_DEBUG
+CFLAGS_DEBUG=-O0 -g -D_DEBUG
 ifeq ($(DEBUG_BUILD),YES)
 CFLAGS_COMMON+=$(CFLAGS_DEBUG)
 else
@@ -190,14 +190,14 @@
 CLIENT_EXE=warsow_$(ARCH).exe
 SERVER_EXE=wsw_server_$(ARCH).exe
 TV_SERVER_EXE=wswtv_server_$(ARCH).exe
-else # USE_MINGW
+else # when USE_MINGW=NO
 ####################### NORMAL *NIX? ######################
 LOCALBASE?=/usr/local
 X11BASE?=/usr/X11R6
 
 CFLAGS_COMMON=$(CFLAGS) -pipe -I. -I$(LOCALBASE)/include -I$(X11BASE)/include -D_LARGEFILE_SOURCE -D_LARGEFILE64_SOURCE -Wall -Wno-unused-function -fvisibility=hidden
 CFLAGS_RELEASE=-O2 -fno-strict-aliasing -ffast-math -funroll-loops -DNDEBUG -msse2
-CFLAGS_DEBUG=-O0 -ggdb -D_DEBUG
+CFLAGS_DEBUG=-O0 -D_DEBUG
 ifeq ($(DEBUG_BUILD),YES)
 CFLAGS_COMMON+=$(CFLAGS_DEBUG)
 else
@@ -206,16 +206,16 @@
 
 CFLAGS_CLIENT=$(shell curl-config --cflags)
 CFLAGS_DED=-DDEDICATED_ONLY -DC_ONLY $(shell curl-config --cflags)
-CFLAGS_MODULE=-DPIC -fPIC
+CFLAGS_MODULE=-DPIC -fPIC -D_REENTRANT
 CFLAGS_TV_SERVER=-DDEDICATED_ONLY -DTV_SERVER_ONLY -DC_ONLY -DTV_MODULE_HARD_LINKED
 
 LDFLAGS_COMMON=$(LDFLAGS)
 LXXFLAGS_COMMON=$(LDFLAGS) -lstdc++ -lsupc++
 
 ifeq ($(OS),FreeBSD)
-LDFLAGS_COMMON+= -L/usr/local/lib -lm -pthread
+LDFLAGS_COMMON+= -L/usr/lib -lm -pthread
 else
-LDFLAGS_COMMON+= -L/usr/local/lib -ldl -lm -O1 -Wl,--as-needed
+LDFLAGS_COMMON+= -L/usr/lib -ldl -lm -Wl,-O1
 endif
 
 ifneq ($(DEBUG_BUILD),YES)
@@ -223,11 +223,7 @@
 LXXFLAGS_COMMON+= -s
 endif
 
-ifeq ($(ARCH),x86_64)
-LIB=lib64
-else
 LIB=lib
-endif
 
 LDFLAGS_CLIENT=-ljpeg -lpng -lz -L$(X11BASE)/$(LIB) -lX11 -lXext -lXxf86dga -lXxf86vm -lXinerama -lXrandr -lrt $(shell curl-config --libs)
 LDFLAGS_DED=-lz $(shell curl-config --libs)
@@ -258,9 +254,9 @@
 LDFLAGS_IRC=
 LDFLAGS_ANGELWRAP=$(ANGELSCRIPT_LIB) -lpthread
 
-CLIENT_EXE=warsow.$(ARCH)
-SERVER_EXE=wsw_server.$(ARCH)
-TV_SERVER_EXE=wswtv_server.$(ARCH)
+CLIENT_EXE=warsow_bin
+SERVER_EXE=wsw_server_bin
+TV_SERVER_EXE=wswtv_server_bin
 endif # USE_MINGW
 
 ####################### MAC support ######################
@@ -271,7 +267,7 @@
 LOCALBASE?=/usr
 CFLAGS_COMMON=-arch ppc -arch i386 -I. -I$(LOCALBASE)/include -Wall -isysroot /Developer/SDKs/MacOSX10.4u.sdk -mmacosx-version-min=10.4
 CFLAGS_RELEASE=-O2 -fno-strict-aliasing -ffast-math -funroll-loops -DNDEBUG -fvisibility=hidden
-CFLAGS_DEBUG=-O0 -ggdb -D_DEBUG
+CFLAGS_DEBUG=-O0 -g -D_DEBUG
 ifeq ($(DEBUG_BUILD),YES)
 CFLAGS_COMMON+=$(CFLAGS_DEBUG)
 else
@@ -298,21 +294,18 @@
 ######################################################################################################
 # Helper functions
 ######################################################################################################
-DO_CC=echo "  > Compiling $<" && \
-	$(CC) $(CFLAGS_COMMON) -c $< -o $@
-DO_CXX=echo "  > Compiling (c++) $<" && \
-	$(CXX) $(CFLAGS_COMMON) $(CXXFLAGS_COMMON) -c $< -o $@
-DO_RES=echo "  > Compiling resource $<" && \
-	$(RES) $(RESFLAGS_COMMON) -i $< -o $@
-
-DO_CC_CLIENT=$(DO_CC) $(CFLAGS_CLIENT)
-DO_CC_DED=$(DO_CC) $(CFLAGS_DED)
-DO_CC_MODULE=$(DO_CC) $(CFLAGS_MODULE)
-DO_CC_TV_SERVER=$(DO_CC) $(CFLAGS_TV_SERVER)
+DO_CC=$(CC) $(CFLAGS_COMMON) -c $< -o $@
+DO_CXX=$(CXX) $(CFLAGS_COMMON) $(CXXFLAGS_COMMON) -c $< -o $@
+DO_RES=$(RES) $(RESFLAGS_COMMON) -i $< -o $@
+
+DO_CC_CLIENT=@echo "$(DO_CC) $(CFLAGS_CLIENT)" && $(DO_CC) $(CFLAGS_CLIENT)
+DO_CC_DED=@echo "$(DO_CC) $(CFLAGS_DED)" && $(DO_CC) $(CFLAGS_DED)
+DO_CC_MODULE=@echo "$(DO_CC) $(CFLAGS_MODULE)" && $(DO_CC) $(CFLAGS_MODULE)
+DO_CC_TV_SERVER=@echo "$(DO_CC) $(CFLAGS_TV_SERVER)" && $(DO_CC) $(CFLAGS_TV_SERVER)
 
-DO_CXX_MODULE=$(DO_CXX) $(CFLAGS_MODULE)
+DO_CXX_MODULE=@echo "$(DO_CXX) $(CFLAGS_MODULE)" && $(DO_CXX) $(CFLAGS_MODULE)
 
-DO_RES_CLIENT=$(DO_RES)
+DO_RES_CLIENT=@echo "$(DO_RES)" && $(DO_RES)
 
 ######################################################################################################
 # Files
@@ -697,12 +690,13 @@
 
 ######################################################################################################
 # Linking Rules
+# Need to display all options used for later viewing from build logs.
 ######################################################################################################
 ########
 # DED
 ########
 $(BINDIR)/$(SERVER_EXE): $(OBJS_DED)
-	@echo "  > Linking $@" && \
+	@echo "$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_DED)" && \
 	$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_DED)
 
 #########
@@ -710,11 +704,11 @@
 #########
 ifeq ($(OS),Darwin)
 $(BINDIR)/$(CLIENT_EXE): $(OBJS_CLIENT)
-	@echo "  > Linking $@" && \
+	@echo "$(LD) -o $@ $(OBJS_CLIENT) mac/SDLMain.m $(LDFLAGS_COMMON) $(LDFLAGS_CLIENT)" && \
 	$(LD) -o $@ $(OBJS_CLIENT) mac/SDLMain.m $(LDFLAGS_COMMON) $(LDFLAGS_CLIENT)
 else
 $(BINDIR)/$(CLIENT_EXE): $(OBJS_CLIENT)
-	@echo "  > Linking $@" && \
+	@echo "$(LD) -o $@ $(OBJS_CLIENT) $(LDFLAGS_COMMON) $(LDFLAGS_CLIENT)" && \
 	$(LD) -o $@ $(OBJS_CLIENT) $(LDFLAGS_COMMON) $(LDFLAGS_CLIENT)
 endif
 
@@ -722,48 +716,48 @@
 # OPENAL
 #########
 $(BINDIR)/libs/snd_openal_$(ARCH).$(SHARED_LIBRARY_EXTENSION): $(OBJS_OPENAL)
-	@echo "  > Linking $@" && \
+	@echo "$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_MODULE) $(LDFLAGS_OPENAL)" && \
 	$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_MODULE) $(LDFLAGS_OPENAL)
 
 #########
 # QF
 #########
 $(BINDIR)/libs/snd_qf_$(ARCH).$(SHARED_LIBRARY_EXTENSION): $(OBJS_QF)
-	@echo "  > Linking $@" && \
+	@echo "$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_MODULE) $(LDFLAGS_QF)" && \
 	$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_MODULE) $(LDFLAGS_QF)
 
 ########
 # .SO
 ########
 $(BINDIR)/basewsw/cgame_$(ARCH).$(SHARED_LIBRARY_EXTENSION): $(OBJS_CGAME)
-	@echo "  > Linking $@" && \
+	@echo "$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_MODULE)" && \
 	$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_MODULE)
 
 $(BINDIR)/basewsw/game_$(ARCH).$(SHARED_LIBRARY_EXTENSION): $(OBJS_GAME)
-	@echo "  > Linking $@" && \
+	@echo "$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_MODULE)" && \
 	$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_MODULE)
 
 $(BINDIR)/basewsw/ui_$(ARCH).$(SHARED_LIBRARY_EXTENSION): $(OBJS_UI_ROCKET)
-	@echo "  > Linking $@" && \
+	@echo "$(LXX) -o $@ $^ $(LXXFLAGS_COMMON) $(LDFLAGS_MODULE) $(LDFLAGS_ROCKET)" && \
 	$(LXX) -o $@ $^ $(LXXFLAGS_COMMON) $(LDFLAGS_MODULE) $(LDFLAGS_ROCKET)
 
 $(BINDIR)/libs/irc_$(ARCH).$(SHARED_LIBRARY_EXTENSION): $(OBJS_IRC)
-	@echo "  > Linking $@" && \
+	@echo "$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_MODULE) $(LDFLAGS_IRC)" && \
 	$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_MODULE) $(LDFLAGS_IRC)
 
 $(BINDIR)/libs/cin_$(ARCH).$(SHARED_LIBRARY_EXTENSION): $(OBJS_CIN)
-	@echo "  > Linking $@" && \
+	@echo "$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_MODULE) $(LDFLAGS_CIN)" && \
 	$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_MODULE) $(LDFLAGS_CIN)
 
 $(BINDIR)/libs/angelwrap_$(ARCH).$(SHARED_LIBRARY_EXTENSION): $(OBJS_ANGELWRAP)
-	@echo "  > Linking $@" && \
+	@echo "$(LXX) -o $@ $^ $(LXXFLAGS_COMMON) $(LDFLAGS_MODULE) $(LDFLAGS_ANGELWRAP)" && \
 	$(LXX) -o $@ $^ $(LXXFLAGS_COMMON) $(LDFLAGS_MODULE) $(LDFLAGS_ANGELWRAP)
 
 ########
 # TV
 ########
 $(BINDIR)/$(TV_SERVER_EXE): $(OBJS_TV_SERVER)
-	@echo "  > Linking $@" && \
+	@echo "$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_TV_SERVER)" && \
 	$(LD) -o $@ $^ $(LDFLAGS_COMMON) $(LDFLAGS_TV_SERVER)
 
 ######################################################################################################
