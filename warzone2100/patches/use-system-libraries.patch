Author: Paul Wise <pabs@debian.org>
Description: use system libraries instead of embedded code copies
Forwarded: no
Index: warzone2100-3.1.0/configure.ac
===================================================================
--- warzone2100-3.1.0.orig/configure.ac	2013-01-15 00:54:06.000000000 +0100
+++ warzone2100-3.1.0/configure.ac	2013-02-24 16:03:21.357648861 +0100
@@ -383,6 +383,12 @@
 
 # Checks for modules:
 
+# Look for minupnpc
+AC_CHECK_HEADER(miniupnpc/miniupnpc.h, , AC_MSG_ERROR([miniupnpc header not found.]))
+AC_CHECK_LIB(miniupnpc, UPNP_GetExternalIPAddress, AC_SUBST([MINIUPNPC_LIBS], [-lminiupnpc]), AC_MSG_ERROR([miniupnpc not found.]), [${WIN32_LIBS}])
+
+PKG_CHECK_MODULES([QUESOGLC], [quesoglc])
+
 if test "$backend" = "sdl"; then
 	PKG_CHECK_MODULES([SDL], [sdl >= 1.2])
 fi
@@ -460,9 +466,6 @@
 WZ_CPPFLAGS="${WZ_CPPFLAGS} -DLOCALEDIR=\"\\\"\${localedir}\\\"\""
 WZ_CPPFLAGS="${WZ_CPPFLAGS} -I\$(top_srcdir)"
 
-# 3rdparty libs
-WZ_CPPFLAGS="${WZ_CPPFLAGS} -I\$(top_srcdir)/3rdparty -I\$(top_srcdir)/3rdparty/quesoglc"
-
 
 AC_SUBST([WZ_CPPFLAGS], [${WZ_CPPFLAGS}])
 AC_SUBST([WZ_CFLAGS], [${WZ_CFLAGS}])
@@ -480,8 +483,6 @@
 		pkg/nsis/Makefile
 		win32/Makefile
 		tests/Makefile
-		3rdparty/miniupnpc/Makefile
-		3rdparty/quesoglc/Makefile
 		lib/framework/Makefile
 		lib/exceptionhandler/Makefile
 		lib/gamelib/Makefile
Index: warzone2100-3.1.0/Makefile.am
===================================================================
--- warzone2100-3.1.0.orig/Makefile.am	2013-01-15 00:54:06.000000000 +0100
+++ warzone2100-3.1.0/Makefile.am	2013-02-24 16:03:21.357648861 +0100
@@ -6,8 +6,6 @@
 
 SUBDIRS = \
 	win32 \
-	3rdparty/miniupnpc \
-	3rdparty/quesoglc \
 	lib/framework \
 	lib/exceptionhandler \
 	lib/script \
Index: warzone2100-3.1.0/po/update-po.sh
===================================================================
--- warzone2100-3.1.0.orig/po/update-po.sh	2013-01-15 00:54:07.000000000 +0100
+++ warzone2100-3.1.0/po/update-po.sh	2013-02-24 16:03:21.357648861 +0100
@@ -10,6 +10,6 @@
 
 find lib src data po -type f |
 	grep -e '\.c\(pp\|xx\)\?$' -e 'data.*strings.*\.txt$' -e 'data.*sequenceaudio.*\.tx.$' -e '\.slo$' -e '\.rmsg$' -e 'po/custom/.*\.txt' -e '\.js$' |
-	grep -v -e '\.lex\.c\(pp\|xx\)\?$' -e '\.tab\.c\(pp\|xx\)\?$' -e 'lib/netplay/miniupnpc/*' -e 'lib/betawidget/*' -e '_moc\.' -e 'po/custom/files.js' |
+	grep -v -e '\.lex\.c\(pp\|xx\)\?$' -e '\.tab\.c\(pp\|xx\)\?$' -e 'lib/betawidget/*' -e '_moc\.' -e 'po/custom/files.js' |
 	grep -v -e '_lexer\.cpp' -e '_parser\.cpp' |
 	sort >> po/POTFILES.in
Index: warzone2100-3.1.0/src/Makefile.am
===================================================================
--- warzone2100-3.1.0.orig/src/Makefile.am	2013-01-15 00:54:07.000000000 +0100
+++ warzone2100-3.1.0/src/Makefile.am	2013-02-24 16:03:21.357648861 +0100
@@ -1,4 +1,4 @@
-AM_CPPFLAGS = -DYY_NO_INPUT $(SDL_CFLAGS) $(PHYSFS_CFLAGS) $(PNG_CFLAGS) $(VORBISFILE_CFLAGS) $(VORBIS_CFLAGS) $(OPENAL_CFLAGS) $(OPENGLC_CFLAGS) $(OPENGL_CFLAGS) $(WZ_CPPFLAGS) $(GLEW_CFLAGS)
+AM_CPPFLAGS = -DYY_NO_INPUT $(SDL_CFLAGS) $(PHYSFS_CFLAGS) $(PNG_CFLAGS) $(VORBISFILE_CFLAGS) $(VORBIS_CFLAGS) $(OPENAL_CFLAGS) $(OPENGLC_CFLAGS) $(OPENGL_CFLAGS) $(WZ_CPPFLAGS) $(GLEW_CFLAGS) $(MINIUPNPC_CFLAGS) $(QUESOGLC_CFLAGS)
 AM_CFLAGS = $(WZ_CFLAGS)
 AM_CXXFLAGS = $(WZ_CXXFLAGS) $(QT4_CFLAGS)
 AM_LFLAGS = $(FLEX_FLAGS)
@@ -273,9 +273,7 @@
 	$(top_builddir)/lib/ivis_opengl/libivis_opengl.a \
 	$(top_builddir)/lib/gamelib/libgamelib.a \
 	$(top_builddir)/lib/framework/libframework.a \
-	$(top_builddir)/lib/exceptionhandler/libexceptionhandler.a \
-	$(top_builddir)/3rdparty/miniupnpc/libminiupnpc.a \
-	$(top_builddir)/3rdparty/quesoglc/libquesoglc.a
+	$(top_builddir)/lib/exceptionhandler/libexceptionhandler.a
 
 if BACKEND_QT
 warzone2100_LIBS += $(top_builddir)/lib/qtgame/libqtgame.a
@@ -287,6 +285,7 @@
 
 warzone2100_LDADD = $(warzone2100_LIBS) $(LTLIBINTL) $(SDL_LIBS) $(PHYSFS_LIBS) $(PNG_LIBS) $(VORBISFILE_LIBS) $(VORBIS_LIBS) \
 	$(THEORA_LIBS) $(OPENAL_LIBS) $(OPENGLC_LIBS) $(OPENGL_LIBS) $(QT4_LIBS) $(GLEW_LIBS) \
+	$(MINIUPNPC_LIBS) $(QUESOGLC_LIBS) \
 	$(X_LIBS) $(X_EXTRA_LIBS) $(LDFLAGS)
 
 if MINGW32
