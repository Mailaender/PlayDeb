#!/usr/bin/make -f
DEB_HOST_GNU_TYPE := $(shell dpkg-architecture -qDEB_HOST_GNU_TYPE)
DEB_HOST_ARCH_CPU := $(shell dpkg-architecture -qDEB_HOST_ARCH_CPU)
DEB_HOST_GNU_CPU := $(shell dpkg-architecture -qDEB_HOST_GNU_CPU | sed -e 's/i.86/i386/')

%:
	dh $@ --parallel

override_dh_auto_clean:
	dh_auto_clean
	rm -rf CMakeFiles

override_dh_auto_configure:
	mkdir -p obj-${DEB_HOST_GNU_TYPE}
	cd obj-${DEB_HOST_GNU_TYPE} && \
	cmake .. -DCMAKE_INSTALL_PREFIX=/usr \
		 -DCMAKE_BUILD_TYPE=RelWithDebInfo \
		 -DCMAKE_SKIP_RPATH=ON \
		 -DNO_UNTRUSTED_PLUGINS=ON \
		 -DGAME_QVM=OFF \
		 $(shell test -f /usr/include/xvid.h || echo -DUSE_CIN_XVID=OFF) \
		 $(shell test -d /usr/include/webp || echo -DUSE_WEBP=OFF)

override_dh_auto_install:

override_dh_install:
	dh_install
	rename "s/daemon/unvanquished/; s%\\.[^./]+$$%%" '{}' ';' debian/unvanquished*/usr/lib/games/unvanquished/daemon*

override_dh_strip:
	dh_strip --dbg-package=unvanquished-dbg
